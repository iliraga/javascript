{"version":3,"sources":["networking/modules/web-node.js"],"names":["log","req","_pickLogger","console","window","start","Date","getTime","timestamp","toISOString","logger","url","qs","on","res","now","elapsed","timestampDone","text","xdr","superagentConstruct","endpoint","callback","_config","logVerbosity","use","proxy","_modules","call","keepAlive","sc","forceBuffered","Blob","buffer","responseType","timeout","end","err","resp","parsedResponse","status","error","operation","statusCode","response","errorData","JSON","parse","e","category","_detectErrorCategory","ignoreBody","headers","redirects","message","service","nativeXdr","_this","options","method","Connection","_query","sendRequest","then","data","cordova","plugin","http","setRequestTimeout","Promise","resolve","reject","postfile","fields","fileInput","agent","superagent","post","forEach","key","value","field","attach","contentType","result","getfile","params","get","getStandardOrigin","set","query","body","send","patch","del"],"mappings":"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","sourcesContent":["/* @flow */\n/* global window */\n\nimport superagent from 'superagent';\nimport { EndpointDefinition, StatusAnnouncement } from '../../core/flow_interfaces';\n\nfunction log(req: Object) {\n  let _pickLogger = () => {\n    if (console && console.log) return console; // eslint-disable-line no-console\n    if (window && window.console && window.console.log) return window.console;\n    return console;\n  };\n\n  let start = new Date().getTime();\n  let timestamp = new Date().toISOString();\n  let logger = _pickLogger();\n  logger.log('<<<<<'); // eslint-disable-line no-console\n  logger.log(`[${timestamp}]`, '\\n', req.url, '\\n', req.qs); // eslint-disable-line no-console\n  logger.log('-----'); // eslint-disable-line no-console\n\n  req.on('response', (res) => {\n    let now = new Date().getTime();\n    let elapsed = now - start;\n    let timestampDone = new Date().toISOString();\n\n    logger.log('>>>>>>'); // eslint-disable-line no-console\n    logger.log(`[${timestampDone} / ${elapsed}]`, '\\n', req.url, '\\n', req.qs, '\\n', res.text); // eslint-disable-line no-console\n    logger.log('-----'); // eslint-disable-line no-console\n  });\n}\n\nfunction xdr(superagentConstruct: superagent, endpoint: EndpointDefinition, callback: Function): Object {\n  if (this._config.logVerbosity) {\n    superagentConstruct = superagentConstruct.use(log);\n  }\n\n  if (this._config.proxy && this._modules.proxy) {\n    superagentConstruct = this._modules.proxy.call(this, superagentConstruct);\n  }\n\n  if (this._config.keepAlive && this._modules.keepAlive) {\n    superagentConstruct = this._modules.keepAlive(superagentConstruct);\n  }\n\n  let sc = superagentConstruct;\n\n  if (endpoint.forceBuffered === true) {\n    if (typeof Blob === 'undefined') {\n      sc = sc.buffer().responseType('arraybuffer');\n    } else {\n      sc = sc.responseType('arraybuffer');\n    }\n  } else if (endpoint.forceBuffered === false) {\n    sc = sc.buffer(false);\n  }\n\n  return sc.timeout(endpoint.timeout).end((err, resp) => {\n    let parsedResponse;\n    let status: StatusAnnouncement = {};\n    status.error = err !== null;\n    status.operation = endpoint.operation;\n\n    if (resp && resp.status) {\n      status.statusCode = resp.status;\n    }\n\n    if (err) {\n      if (err.response && err.response.text && !this._config.logVerbosity) {\n        try {\n          status.errorData = JSON.parse(err.response.text);\n        } catch (e) {\n          status.errorData = err;\n        }\n      } else {\n        status.errorData = err;\n      }\n      status.category = this._detectErrorCategory(err);\n      return callback(status, null);\n    }\n\n    if (endpoint.ignoreBody) {\n      parsedResponse = {\n        headers: resp.headers,\n        redirects: resp.redirects,\n        response: resp,\n      };\n    } else {\n      try {\n        parsedResponse = JSON.parse(resp.text);\n      } catch (e) {\n        status.errorData = resp;\n        status.error = true;\n        return callback(status, null);\n      }\n    }\n\n    if (\n      parsedResponse.error &&\n      parsedResponse.error === 1 &&\n      parsedResponse.status &&\n      parsedResponse.message &&\n      parsedResponse.service\n    ) {\n      status.errorData = parsedResponse;\n      status.statusCode = parsedResponse.status;\n      status.error = true;\n      status.category = this._detectErrorCategory(status);\n      return callback(status, null);\n    } else if (parsedResponse.error && parsedResponse.error.message) {\n      status.errorData = parsedResponse.error;\n    }\n\n    return callback(status, parsedResponse);\n  });\n}\n\n\nfunction nativeXdr(superagentConstruct: superagent, endpoint: EndpointDefinition, callback: Function): Object {\n  var _this = this;\n\n  var options = {\n    method: 'GET',\n    headers: {\n      Connection: \"keep-alive\"\n    },\n    responseType: \"json\",\n    timeout: endpoint.timeout\n  };\n\n  if (endpoint.forceBuffered === true) {\n    options.responseType = \"arraybuffer\"\n  }\n  \n  var err = null, resp;\n  var url = superagentConstruct.url += (superagentConstruct._query && superagentConstruct._query[0] ? \"?\" + superagentConstruct._query[0] : \"\");\n\n  sendRequest(url, options, endpoint.timeout/1000).then(response=> {\n    resp = response;\n  }).catch((error)=>{\n    err = error;\n  }).then(()=>{\n    var parsedResponse;\n    var status = {};\n    status.error = err !== null;\n    status.operation = endpoint.operation;\n\n    if (resp && resp.status) {\n      status.statusCode = resp.status;\n    }\n\n    if (err) {\n      if (err.response && err.response.text && !_this._config.logVerbosity) {\n        try {\n          status.errorData = JSON.parse(err.response.text);\n        } catch (e) {\n          status.errorData = err;\n        }\n      } else {\n        status.errorData = err;\n      }\n\n      status.category = _this._detectErrorCategory(err);\n      return callback(status, null);\n    }\n\n    if (endpoint.ignoreBody) {\n      parsedResponse = {\n        headers: resp.headers,\n        redirects: resp.redirects,\n        response: resp\n      };\n    } else {\n      try {\n        parsedResponse = resp.data\n      } catch (e) {\n        status.errorData = resp;\n        status.error = true;\n        return callback(status, null);\n      }\n    }\n\n    if (parsedResponse.error && parsedResponse.error === 1 && parsedResponse.status && parsedResponse.message && parsedResponse.service) {\n      status.errorData = parsedResponse;\n      status.statusCode = parsedResponse.status;\n      status.error = true;\n      status.category = _this._detectErrorCategory(status);\n      return callback(status, null);\n    } else if (parsedResponse.error && parsedResponse.error.message) {\n      status.errorData = parsedResponse.error;\n    }\n    callback(status, parsedResponse)\n  });\n}\n\nfunction sendRequest(url, options, timeout){\n  cordova.plugin.http.setRequestTimeout(timeout);\n  return new Promise((resolve, reject) => cordova.plugin.http.sendRequest(url, options, resolve, reject));\n}\n\nexport async function postfile(\n  url: string,\n  fields: $ReadOnlyArray<{ key: string, value: string }>,\n  fileInput: any\n): Promise<any> {\n  let agent = superagent.post(url);\n\n  fields.forEach(({ key, value }) => {\n    agent = agent.field(key, value);\n  });\n\n  agent.attach('file', fileInput, { contentType: 'application/octet-stream' });\n\n  const result = await agent;\n\n  return result;\n}\n\nexport function getfile(params: Object, endpoint: EndpointDefinition, callback: Function): superagent {\n  let superagentConstruct = superagent\n    .get(this.getStandardOrigin() + endpoint.url)\n    .set(endpoint.headers)\n    .query(params);\n  return xdr.call(this, superagentConstruct, endpoint, callback);\n}\n\nexport function get(params: Object, endpoint: EndpointDefinition, callback: Function): superagent {\n  let superagentConstruct = superagent\n    .get(this.getStandardOrigin() + endpoint.url)\n    .set(endpoint.headers)\n    .query(params);\n\n  try {\n    return nativeXdr.call(this, superagentConstruct, endpoint, callback);\n  }\n  catch(e){\n      return xdr.call(this, superagentConstruct, endpoint, callback);\n  }\n}\n\nexport function post(params: Object, body: string, endpoint: EndpointDefinition, callback: Function): superagent {\n  let superagentConstruct = superagent\n    .post(this.getStandardOrigin() + endpoint.url)\n    .query(params)\n    .set(endpoint.headers)\n    .send(body);\n  return xdr.call(this, superagentConstruct, endpoint, callback);\n}\n\nexport function patch(params: Object, body: string, endpoint: EndpointDefinition, callback: Function): superagent {\n  let superagentConstruct = superagent\n    .patch(this.getStandardOrigin() + endpoint.url)\n    .query(params)\n    .set(endpoint.headers)\n    .send(body);\n  return xdr.call(this, superagentConstruct, endpoint, callback);\n}\n\nexport function del(params: Object, endpoint: EndpointDefinition, callback: Function): superagent {\n  let superagentConstruct = superagent\n    .delete(this.getStandardOrigin() + endpoint.url)\n    .set(endpoint.headers)\n    .query(params);\n  return xdr.call(this, superagentConstruct, endpoint, callback);\n}\n"],"file":"web-node.js"}